# 개발환경 설정 가이드

## 필수 요구사항

### 1. Java 개발 환경
- **Java 17** (필수)
  - OpenJDK 17 권장
  - 설치 확인: `java -version`
- **Gradle 8.x**
  - 프로젝트에 포함된 Gradle Wrapper 사용 권장
  - `./gradlew` (Linux/Mac) 또는 `gradlew.bat` (Windows)

### 2. 데이터베이스
- **MariaDB 10.11.x**
  - Docker를 통한 설치 권장
  - 로컬 설치도 가능

### 3. 개발 도구
- **IDE**: IntelliJ IDEA (권장) 또는 Eclipse
- **Git**: 버전 관리
- **Docker & Docker Compose**: 데이터베이스 및 인프라 구성
- **Postman**: API 테스트

## 개발환경 설정 단계

### 1단계: 프로젝트 클론
```bash
git clone [repository-url]
cd gw/backend
```

### 2단계: 데이터베이스 설정

#### Docker Compose를 사용한 MariaDB 실행
```bash
# Docker Compose 파일 위치로 이동
cd docker-compose/db

# MariaDB 컨테이너 실행
docker-compose up -d

# 실행 확인
docker ps

# 로그 확인
docker-compose logs -f
```

#### docker-compose.yml 내용
```yaml
version: '3.8'

services:
  mariadb:
    image: mariadb:10.11
    container_name: groupware-mariadb
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: groupware
      MYSQL_USER: groupware
      MYSQL_PASSWORD: groupware123
    volumes:
      - mariadb_data:/var/lib/mysql
      - ./init:/docker-entrypoint-initdb.d
    restart: unless-stopped

volumes:
  mariadb_data:
```

### 3단계: 데이터베이스 초기화

#### 초기 스키마 생성 (init/01-init.sql)
```sql
-- 데이터베이스 생성 (Docker가 자동으로 생성하지만 확인차)
CREATE DATABASE IF NOT EXISTS groupware CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE groupware;

-- 사용자 테이블 예시
CREATE TABLE IF NOT EXISTS user_info (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL UNIQUE,
    user_name VARCHAR(100) NOT NULL,
    email VARCHAR(100),
    department VARCHAR(100),
    position VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updated_by VARCHAR(50),
    deleted_at TIMESTAMP NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_department (department)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 일정 테이블 예시
CREATE TABLE IF NOT EXISTS schedule (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,
    all_day BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(50),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    updated_by VARCHAR(50),
    deleted_at TIMESTAMP NULL,
    INDEX idx_user_schedule (user_id, start_date),
    FOREIGN KEY (user_id) REFERENCES user_info(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 4단계: IDE 설정

#### IntelliJ IDEA 설정
1. **프로젝트 Import**
   - File → Open → backend 폴더 선택
   - Gradle 프로젝트로 자동 인식

2. **JDK 설정**
   - File → Project Structure → Project
   - SDK: Java 17 선택

3. **Gradle 설정**
   - File → Settings → Build, Execution, Deployment → Build Tools → Gradle
   - Gradle JVM: Java 17 선택
   - Build and run using: IntelliJ IDEA (선택사항)

4. **Lombok 플러그인** (사용 시)
   - File → Settings → Plugins
   - "Lombok" 검색 및 설치
   - Enable annotation processing 활성화

#### VS Code 설정 (대안)
1. **확장 프로그램 설치**
   - Java Extension Pack
   - Spring Boot Extension Pack
   - Gradle for Java

2. **settings.json 설정**
```json
{
  "java.configuration.runtimes": [
    {
      "name": "JavaSE-17",
      "path": "/path/to/java17"
    }
  ],
  "java.home": "/path/to/java17"
}
```

### 5단계: 애플리케이션 실행

#### 1. 환경변수 설정 (선택사항)
```bash
# Linux/Mac
export DB_USERNAME=groupware
export DB_PASSWORD=groupware123

# Windows
set DB_USERNAME=groupware
set DB_PASSWORD=groupware123
```

#### 2. 전체 프로젝트 빌드
```bash
# 프로젝트 루트에서
./gradlew clean build

# Windows
gradlew.bat clean build
```

#### 3. 개별 서비스 실행
```bash
# app.core 실행
./gradlew :app.core:bootRun

# app.streamhub 실행 (별도 터미널)
./gradlew :app.streamhub:bootRun
```

#### 4. IDE에서 실행
- `CoreServiceApplication.java` 우클릭 → Run
- `StreamhubServiceApplication.java` 우클릭 → Run

### 6단계: 실행 확인

#### 헬스체크
```bash
# app.core
curl http://localhost:8080/actuator/health

# app.streamhub  
curl http://localhost:8081/actuator/health
```

#### 기본 API 테스트
```bash
# 사용자 목록 조회
curl http://localhost:8080/api/v1/users

# 일정 목록 조회
curl http://localhost:8080/api/v1/schedules
```

## 개발 팁

### 1. 프로파일 설정
```bash
# 개발 환경
./gradlew bootRun --args='--spring.profiles.active=dev'

# 운영 환경
./gradlew bootRun --args='--spring.profiles.active=prod'
```

### 2. 디버깅
- IDE에서 Debug 모드로 실행
- Remote Debug 설정:
```bash
./gradlew bootRun --debug-jvm
```

### 3. 로그 레벨 변경
```yaml
# application-dev.yml
logging:
  level:
    kr.co.groupware: DEBUG
    org.mybatis: DEBUG
```

### 4. 데이터베이스 연결 문제 해결
```bash
# MariaDB 컨테이너 접속
docker exec -it groupware-mariadb mysql -u groupware -p

# 연결 테스트
mysql> SHOW DATABASES;
mysql> USE groupware;
mysql> SHOW TABLES;
```

## 트러블슈팅

### 포트 충돌
```bash
# 사용 중인 포트 확인
# Linux/Mac
lsof -i :8080
lsof -i :3306

# Windows
netstat -ano | findstr :8080
netstat -ano | findstr :3306
```

### Gradle 빌드 오류
```bash
# Gradle 캐시 삭제
./gradlew clean
rm -rf ~/.gradle/caches/

# 의존성 새로고침
./gradlew --refresh-dependencies
```

### 데이터베이스 연결 실패
1. Docker 컨테이너 상태 확인
2. 방화벽 설정 확인
3. application.yml의 데이터베이스 설정 확인

## 유용한 스크립트

### 전체 재시작 스크립트 (restart-all.sh)
```bash
#!/bin/bash
echo "Stopping all services..."
pkill -f "spring-boot"

echo "Rebuilding project..."
./gradlew clean build

echo "Starting app.core..."
nohup ./gradlew :app.core:bootRun > app.core.log 2>&1 &

echo "Starting app.streamhub..."
nohup ./gradlew :app.streamhub:bootRun > app.streamhub.log 2>&1 &

echo "All services started. Check logs for details."
```